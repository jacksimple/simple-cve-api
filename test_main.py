from starlette.testclient import TestClient

from main import app

client = TestClient(app)


def test_single_cve_exist():
    response = client.get("/v1/cve/cve-2019-10842")
    assert response.status_code == 200
    assert response.json()[0]["cve_data_meta"]["ID"] == "CVE-2019-10842"


def test_single_cve_non_exist():
    response = client.get("/v1/cve/cve-2019-108A42")
    assert response.status_code == 200
    assert response.json() == []


def test_search_exist():
    response = client.get("/v1/search/?q=bootstrap-sass")
    assert response.status_code == 200
    assert len(response.json()) >= 1


def test_search_multi_exist():
    response = client.get("/v1/search/?q=bootstrap")
    assert response.status_code == 200
    assert len(response.json()) > 1


def test_search_limit_cap():
    response = client.get("/v1/search/?q=%%")
    assert response.status_code == 200
    assert len(response.json()) == 100


def test_search_non_exist():
    response = client.get("/v1/search/?q=bootstrap-sasssssss")
    assert response.status_code == 200
    assert response.json() == []
